function Ge(b,L){for(var x=0;x<L.length;x++){const m=L[x];if(typeof m!="string"&&!Array.isArray(m)){for(const p in m)if(p!=="default"&&!(p in b)){const v=Object.getOwnPropertyDescriptor(m,p);v&&Object.defineProperty(b,p,v.get?v:{enumerable:!0,get:()=>m[p]})}}}return Object.freeze(Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}))}var yt={};(function(){var b=tinymce.util.Tools.resolve("tinymce.PluginManager");const L=(t,e,n)=>{var s;return n(t,e.prototype)?!0:((s=t.constructor)===null||s===void 0?void 0:s.name)===e.name},x=t=>{const e=typeof t;return t===null?"null":e==="object"&&Array.isArray(t)?"array":e==="object"&&L(t,String,(n,s)=>s.isPrototypeOf(n))?"string":e},m=t=>e=>x(e)===t,p=t=>e=>typeof e===t,v=t=>e=>t===e,k=m("string"),F=m("object"),A=m("array"),bt=v(null),j=p("boolean"),xt=t=>t==null,N=t=>!xt(t),$=p("function"),K=(t,e)=>{if(A(t)){for(let n=0,s=t.length;n<s;++n)if(!e(t[n]))return!1;return!0}return!1},_=()=>{},vt=t=>()=>t,_t=(t,e)=>t===e;class r{constructor(e,n){this.tag=e,this.value=n}static some(e){return new r(!0,e)}static none(){return r.singletonNone}fold(e,n){return this.tag?n(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?r.some(e(this.value)):r.none()}bind(e){return this.tag?e(this.value):r.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:r.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(e){return N(e)?r.some(e):r.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}r.singletonNone=new r(!1);const Lt=Array.prototype.indexOf,Ct=Array.prototype.push,Tt=(t,e)=>Lt.call(t,e),wt=(t,e)=>Tt(t,e)>-1,Ot=(t,e)=>{const n=t.length,s=new Array(n);for(let o=0;o<n;o++){const l=t[o];s[o]=e(l,o)}return s},St=(t,e)=>{for(let n=0,s=t.length;n<s;n++){const o=t[n];e(o,n)}},At=(t,e,n)=>(St(t,(s,o)=>{n=e(n,s,o)}),n),q=t=>{const e=[];for(let n=0,s=t.length;n<s;++n){if(!A(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);Ct.apply(e,t[n])}return e},Nt=(t,e)=>q(Ot(t,e)),V=(t,e)=>{for(let n=0;n<t.length;n++){const s=e(t[n],n);if(s.isSome())return s}return r.none()},G=(t,e,n=_t)=>t.exists(s=>n(s,e)),Rt=t=>{const e=[],n=s=>{e.push(s)};for(let s=0;s<t.length;s++)t[s].each(n);return e},C=(t,e)=>t?r.some(e):r.none(),f=t=>e=>e.options.get(t),Pt=t=>{const e=t.options.register;e("link_assume_external_targets",{processor:n=>{const s=k(n)||j(n);return s?n===!0?{value:1,valid:s}:n==="http"||n==="https"?{value:n,valid:s}:{value:0,valid:s}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),e("link_context_toolbar",{processor:"boolean",default:!1}),e("link_list",{processor:n=>k(n)||$(n)||K(n,F)}),e("link_default_target",{processor:"string"}),e("link_default_protocol",{processor:"string",default:"https"}),e("link_target_list",{processor:n=>j(n)||K(n,F),default:!0}),e("link_rel_list",{processor:"object[]",default:[]}),e("link_class_list",{processor:"object[]",default:[]}),e("link_title",{processor:"boolean",default:!0}),e("allow_unsafe_link_target",{processor:"boolean",default:!1}),e("link_quicklink",{processor:"boolean",default:!1})},W=f("link_assume_external_targets"),Et=f("link_context_toolbar"),It=f("link_list"),H=f("link_default_target"),Dt=f("link_default_protocol"),J=f("link_target_list"),Q=f("link_rel_list"),Mt=f("link_class_list"),Ut=f("link_title"),X=f("allow_unsafe_link_target"),Bt=f("link_quicklink");var T=tinymce.util.Tools.resolve("tinymce.util.Tools");const R=t=>k(t.value)?t.value:"",zt=t=>k(t.text)?t.text:k(t.title)?t.title:"",Y=(t,e)=>{const n=[];return T.each(t,s=>{const o=zt(s);if(s.menu!==void 0){const l=Y(s.menu,e);n.push({text:o,items:l})}else{const l=e(s);n.push({text:o,value:l})}}),n},Z=(t=R)=>e=>r.from(e).map(n=>Y(n,t)),h={sanitize:t=>Z(R)(t),sanitizeWith:Z,createUi:(t,e)=>n=>({name:t,type:"listbox",label:e,items:n}),getValue:R},Ft=Object.keys,jt=Object.hasOwnProperty,$t=(t,e)=>{const n=Ft(t);for(let s=0,o=n.length;s<o;s++){const l=n[s],c=t[l];e(c,l)}},Kt=t=>(e,n)=>{t[n]=e},qt=(t,e,n,s)=>{$t(t,(o,l)=>{(e(o,l)?n:s)(o,l)})},Vt=(t,e)=>{const n={};return qt(t,e,Kt(n),_),n},P=(t,e)=>jt.call(t,e),Gt=(t,e)=>P(t,e)&&t[e]!==void 0&&t[e]!==null;var Wt=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Ht=tinymce.util.Tools.resolve("tinymce.util.URI");const tt=t=>N(t)&&t.nodeName.toLowerCase()==="a",et=t=>tt(t)&&!!E(t),nt=(t,e)=>{if(t.collapsed)return[];{const n=t.cloneContents(),s=n.firstChild,o=new Wt(s,n),l=[];let c=s;do e(c)&&l.push(c);while(c=o.next());return l}},st=t=>/^\w+:/i.test(t),E=t=>{var e,n;return(n=(e=t.getAttribute("data-mce-href"))!==null&&e!==void 0?e:t.getAttribute("href"))!==null&&n!==void 0?n:""},ot=(t,e)=>{const n=["noopener"],s=t?t.split(/\s+/):[],o=a=>T.trim(a.sort().join(" ")),l=a=>(a=c(a),a.length>0?a.concat(n):n),c=a=>a.filter(u=>T.inArray(n,u)===-1),g=e?l(s):c(s);return g.length>0?o(g):""},Jt=t=>t.replace(/\uFEFF/g,""),d=(t,e)=>(e=e||I(t.selection.getRng())[0]||t.selection.getNode(),D(e)?r.from(t.dom.select("a[href]",e)[0]):r.from(t.dom.getParent(e,"a[href]"))),w=(t,e)=>d(t,e).isSome(),lt=(t,e)=>{const n=e.fold(()=>t.getContent({format:"text"}),s=>s.innerText||s.textContent||"");return Jt(n)},I=t=>nt(t,et),rt=t=>T.grep(t,et),at=t=>rt(t).length>0,Qt=t=>I(t).length>0,ct=t=>{const e=t.schema.getTextInlineElements(),n=l=>l.nodeType===1&&!tt(l)&&!P(e,l.nodeName.toLowerCase());if(d(t).exists(l=>l.hasAttribute("data-mce-block")))return!1;const o=t.selection.getRng();return o.collapsed?!0:nt(o,n).length===0},D=t=>N(t)&&t.nodeName==="FIGURE"&&/\bimage\b/i.test(t.className),Xt=t=>At(["title","rel","class","target"],(n,s)=>(t[s].each(o=>{n[s]=o.length>0?o:null}),n),{href:t.href}),Yt=(t,e)=>(e==="http"||e==="https")&&!st(t)?e+"://"+t:t,Zt=(t,e)=>{const n={...e};if(Q(t).length===0&&!X(t)){const s=ot(n.rel,n.target==="_blank");n.rel=s||null}return r.from(n.target).isNone()&&J(t)===!1&&(n.target=H(t)),n.href=Yt(n.href,W(t)),n},te=(t,e,n,s)=>{n.each(o=>{P(e,"innerText")?e.innerText=o:e.textContent=o}),t.dom.setAttribs(e,s),t.selection.select(e)},ee=(t,e,n,s)=>{const o=t.dom;D(e)?ce(o,e,s):n.fold(()=>{t.execCommand("mceInsertLink",!1,s)},l=>{t.insertContent(o.createHTML("a",s,o.encode(l)))})},ne=(t,e,n)=>{const s=t.selection.getNode(),o=d(t,s),l=Zt(t,Xt(n));t.undoManager.transact(()=>{n.href===e.href&&e.attach(),o.fold(()=>{ee(t,s,n.text,l)},c=>{t.focus(),te(t,c,n.text,l)})})},se=t=>{const e=t.dom,n=t.selection,s=n.getBookmark(),o=n.getRng().cloneRange(),l=e.getParent(o.startContainer,"a[href]",t.getBody()),c=e.getParent(o.endContainer,"a[href]",t.getBody());l&&o.setStartBefore(l),c&&o.setEndAfter(c),n.setRng(o),t.execCommand("unlink"),n.moveToBookmark(s)},oe=t=>{t.undoManager.transact(()=>{const e=t.selection.getNode();D(e)?ae(t,e):se(t),t.focus()})},le=t=>{const{class:e,href:n,rel:s,target:o,text:l,title:c}=t;return Vt({class:e.getOrNull(),href:n,rel:s.getOrNull(),target:o.getOrNull(),text:l.getOrNull(),title:c.getOrNull()},(g,a)=>bt(g)===!1)},re=(t,e)=>{const n=t.options.get,s={allow_html_data_urls:n("allow_html_data_urls"),allow_script_urls:n("allow_script_urls"),allow_svg_data_urls:n("allow_svg_data_urls")},o=e.href;return{...e,href:Ht.isDomSafe(o,"a",s)?o:""}},it=(t,e,n)=>{const s=re(t,n);t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,le(s)):ne(t,e,s)},O=t=>{t.hasPlugin("rtc",!0)?t.execCommand("unlink"):oe(t)},ae=(t,e)=>{var n;const s=t.dom.select("img",e)[0];if(s){const o=t.dom.getParents(s,"a[href]",e)[0];o&&((n=o.parentNode)===null||n===void 0||n.insertBefore(s,o),t.dom.remove(o))}},ce=(t,e,n)=>{var s;const o=t.select("img",e)[0];if(o){const l=t.create("a",n);(s=o.parentNode)===null||s===void 0||s.insertBefore(l,o),l.appendChild(o)}},ie=t=>Gt(t,"items"),ut=(t,e)=>V(e,n=>ie(n)?ut(t,n.items):C(n.value===t,n)),gt=(t,e,n,s)=>{const o=s[e],l=t.length>0;return o!==void 0?ut(o,n).map(c=>({url:{value:c.value,meta:{text:l?t:c.text,attach:_}},text:l?t:c.text})):r.none()},ue=(t,e)=>e==="link"?t.link:e==="anchor"?t.anchor:r.none(),ge={init:(t,e)=>{const n={text:t.text,title:t.title},s=a=>{var u;return C(n.title.length<=0,r.from((u=a.meta)===null||u===void 0?void 0:u.title).getOr(""))},o=a=>{var u;return C(n.text.length<=0,r.from((u=a.meta)===null||u===void 0?void 0:u.text).getOr(a.value))},l=a=>{const u=o(a.url),i=s(a.url);return u.isSome()||i.isSome()?r.some({...u.map(y=>({text:y})).getOr({}),...i.map(y=>({title:y})).getOr({})}):r.none()},c=(a,u)=>{const i=ue(e,u).getOr([]);return gt(n.text,u,i,a)};return{onChange:(a,u)=>{const i=u.name;return i==="url"?l(a()):wt(["anchor","link"],i)?c(a(),i):((i==="text"||i==="title")&&(n[i]=a()[i]),r.none())}}},getDelta:gt};var fe=tinymce.util.Tools.resolve("tinymce.util.Delay");const he=(t,e,n)=>{const s=t.selection.getRng();fe.setEditorTimeout(t,()=>{t.windowManager.confirm(e,o=>{t.selection.setRng(s),n(o)})})},me=t=>{const e=t.href;return e.indexOf("@")>0&&e.indexOf("/")===-1&&e.indexOf("mailto:")===-1?r.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:s=>({...s,href:"mailto:"+e})}):r.none()},pe=(t,e)=>n=>{const s=n.href;return t===1&&!st(s)||t===0&&/^\s*www(\.|\d\.)/i.test(s)?r.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${e}:// prefix?`,preprocess:l=>({...l,href:e+"://"+s})}):r.none()},ke={preprocess:(t,e)=>V([me,pe(W(t),Dt(t))],n=>n(e)).fold(()=>Promise.resolve(e),n=>new Promise(s=>{he(t,n.message,o=>{s(o?n.preprocess(e):e)})}))},de={getAnchors:t=>{const e=t.dom.select("a:not([href])"),n=Nt(e,s=>{const o=s.name||s.id;return o?[{text:o,value:"#"+o}]:[]});return n.length>0?r.some([{text:"None",value:""}].concat(n)):r.none()}},ye={getClasses:t=>{const e=Mt(t);return e.length>0?h.sanitize(e):r.none()}},be=t=>{try{return r.some(JSON.parse(t))}catch{return r.none()}},xe={getLinks:t=>{const e=s=>t.convertURL(s.value||s.url||"","href"),n=It(t);return new Promise(s=>{k(n)?fetch(n).then(o=>o.ok?o.text().then(be):Promise.reject()).then(s,()=>s(r.none())):$(n)?n(o=>s(r.some(o))):s(r.from(n))}).then(s=>s.bind(h.sanitizeWith(e)).map(o=>o.length>0?[{text:"None",value:""}].concat(o):o))}},ve={getRels:(t,e)=>{const n=Q(t);if(n.length>0){const s=G(e,"_blank"),o=X(t)===!1,l=g=>ot(h.getValue(g),s);return(o?h.sanitizeWith(l):h.sanitize)(n)}return r.none()}},ft=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],_e={getTargets:t=>{const e=J(t);return A(e)?h.sanitize(e).orThunk(()=>r.some(ft)):e===!1?r.none():r.some(ft)}},M=(t,e,n)=>{const s=t.getAttrib(e,n);return s!==null&&s.length>0?r.some(s):r.none()},Le=(t,e)=>{const n=t.dom,o=ct(t)?r.some(lt(t.selection,e)):r.none(),l=e.bind(i=>r.from(n.getAttrib(i,"href"))),c=e.bind(i=>r.from(n.getAttrib(i,"target"))),g=e.bind(i=>M(n,i,"rel")),a=e.bind(i=>M(n,i,"class")),u=e.bind(i=>M(n,i,"title"));return{url:l,text:o,title:u,target:c,rel:g,linkClass:a}},Ce={collect:(t,e)=>xe.getLinks(t).then(n=>{const s=Le(t,e);return{anchor:s,catalogs:{targets:_e.getTargets(t),rels:ve.getRels(t,s.target),classes:ye.getClasses(t),anchor:de.getAnchors(t),link:n},optNode:e,flags:{titleEnabled:Ut(t)}}})},Te=(t,e)=>n=>{const s=n.getData();if(!s.url.value){O(t),n.close();return}const o=g=>r.from(s[g]).filter(a=>!G(e.anchor[g],a)),l={href:s.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},c={href:s.url.value,attach:s.url.meta!==void 0&&s.url.meta.attach?s.url.meta.attach:_};ke.preprocess(t,l).then(g=>{it(t,c,g)}),n.close()},we=t=>{const e=d(t);return Ce.collect(t,e)},Oe=(t,e)=>{const n=t.anchor,s=n.url.getOr("");return{url:{value:s,meta:{original:{value:s}}},text:n.text.getOr(""),title:n.title.getOr(""),anchor:s,link:s,rel:n.rel.getOr(""),target:n.target.or(e).getOr(""),linkClass:n.linkClass.getOr("")}},Se=(t,e,n)=>{const s=[{name:"url",type:"urlinput",filetype:"file",label:"URL",picker_text:"Browse links"}],o=t.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),l=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],c=r.from(H(n)),g=Oe(t,c),a=t.catalogs,u=ge.init(g,a);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:q([s,o,l,Rt([a.anchor.map(h.createUi("anchor","Anchors")),a.rels.map(h.createUi("rel","Rel")),a.targets.map(h.createUi("target","Open link in...")),a.link.map(h.createUi("link","Link list")),a.classes.map(h.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:g,onChange:(y,{name:qe})=>{u.onChange(y.getData,{name:qe}).each(Ve=>{y.setData(Ve)})},onSubmit:e}},Ae=t=>{we(t).then(n=>{const s=Te(t,n);return Se(n,s,t)}).then(n=>{t.windowManager.open(n)})},Ne=t=>{t.addCommand("mceLink",(e,n)=>{(n==null?void 0:n.dialog)===!0||!Bt(t)?Ae(t):t.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"})})};var Re=tinymce.util.Tools.resolve("tinymce.util.VK");const Pe=(t,e)=>{document.body.appendChild(t),t.dispatchEvent(e),document.body.removeChild(t)},Ee=t=>{const e=document.createElement("a");e.target="_blank",e.href=t,e.rel="noreferrer noopener";const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),Pe(e,n)},ht=(t,e)=>t.dom.getParent(e,"a[href]"),mt=t=>ht(t,t.selection.getStart()),Ie=t=>t.altKey===!0&&t.shiftKey===!1&&t.ctrlKey===!1&&t.metaKey===!1,U=(t,e)=>{if(e){const n=E(e);if(/^#/.test(n)){const s=t.dom.select(n);s.length&&t.selection.scrollIntoView(s[0],!0)}else Ee(e.href)}},pt=t=>()=>{t.execCommand("mceLink",!1,{dialog:!0})},B=t=>()=>{U(t,mt(t))},De=t=>{t.on("click",e=>{const n=ht(t,e.target);n&&Re.metaKeyPressed(e)&&(e.preventDefault(),U(t,n))}),t.on("keydown",e=>{if(!e.isDefaultPrevented()&&e.keyCode===13&&Ie(e)){const n=mt(t);n&&(e.preventDefault(),U(t,n))}})},S=(t,e)=>(t.on("NodeChange",e),()=>t.off("NodeChange",e)),z=t=>e=>{const n=()=>{e.setActive(!t.mode.isReadOnly()&&w(t,t.selection.getNode())),e.setEnabled(t.selection.isEditable())};return n(),S(t,n)},Me=t=>e=>{const n=()=>{e.setEnabled(t.selection.isEditable())};return n(),S(t,n)},Ue=t=>(t.selection.isCollapsed()?rt(t.dom.getParents(t.selection.getStart())):I(t.selection.getRng())).length===1,kt=t=>e=>{const n=()=>e.setEnabled(Ue(t));return n(),S(t,n)},dt=t=>e=>{const n=l=>at(l)||Qt(t.selection.getRng()),s=t.dom.getParents(t.selection.getStart()),o=l=>{e.setEnabled(n(l)&&t.selection.isEditable())};return o(s),S(t,l=>o(l.parents))},Be=t=>{t.addShortcut("Meta+K","",()=>{t.execCommand("mceLink")})},ze=t=>{t.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:pt(t),onSetup:z(t)}),t.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:B(t),onSetup:kt(t)}),t.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>O(t),onSetup:dt(t)})},Fe=t=>{t.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:B(t),onSetup:kt(t)}),t.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onSetup:Me(t),onAction:pt(t)}),t.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>O(t),onSetup:dt(t)})},je=t=>{const e="link unlink openlink",n="link";t.ui.registry.addContextMenu("link",{update:s=>t.dom.isEditable(s)?at(t.dom.getParents(s,"a"))?e:n:""})},$e=t=>{const e=o=>{o.selection.collapse(!1)},n=o=>{const l=t.selection.getNode();return o.setEnabled(w(t,l)),_},s=o=>{const l=d(t),c=ct(t);if(l.isNone()&&c){const g=lt(t.selection,l);return C(g.length===0,o)}else return r.none()};t.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:z(t)},label:"Link",predicate:o=>Et(t)&&w(t,o),initValue:()=>d(t).fold(vt(""),E),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:o=>{const l=t.selection.getNode();return o.setActive(w(t,l)),z(t)(o)},onAction:o=>{const l=o.getValue(),c=s(l);it(t,{href:l,attach:_},{href:l,text:c,title:r.none(),rel:r.none(),target:r.none(),class:r.none()}),e(t),o.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:n,onAction:o=>{O(t),o.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:n,onAction:o=>{B(t)(),o.hide()}}]})};var Ke=()=>{b.add("link",t=>{Pt(t),ze(t),Fe(t),je(t),$e(t),De(t),Ne(t),Be(t)})};Ke()})();const sn=Ge({__proto__:null,default:yt},[yt]);export{sn as i};
